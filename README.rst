IIIF Mapping
============

Needs to provide a mappings.csv file, which can be generated by this query on PostgreSQL MediaMosa DB:

this is set in the openshift buildconfig  as env for download

.. code-block:: sql

        select
                CAST(CASE
                        WHEN mediafile_id_source IS NULL THEN mediafile_id
                        ELSE mediafile_id_source
                END AS CHAR(64)) as mediafile_id ,
                CAST(asset_id AS CHAR(64)) as asset_id,
                SUBSTRING(filename, 1, LENGTH(filename)-4) as pid
        from
                mediamosa_asset_mediafile
        left join
                mediamosa_asset USING (asset_id)
        where
                mediamosa_asset_mediafile.app_id = 5
                and filename like '%\_%.jp_'
                and filename not like '%jp2.jp2'
        GROUP BY pid
        ORDER BY pid ASC


A pre-created mapping file is available on the VIAA dropbox.

Installation
------------

1. Clone the repository
2. Install python requirements (use `pip` or `pip3` depending on your python installation(s))

.. code-block:: bash

        git clone https://github.com/viaacode/iiif-mapping.git
        cd iiif-mapping
        pip install -r requirements.txt


Usage
-----

1. Make sure these environmental variables are properly defined:

.. code-block:: bash

        MEDIAMOSA_HOST=https://example.com
        MEDIAMOSA_USER=username
        MEDIAMOSA_PASS=password

Optional (has sensible defaults):

.. code-block:: bash

        # default is mappings.csv from current working directory
        IIIF_MAPPING_FILE=/path/to/mappings.csv

2. Start the webserver:

.. code-block:: bash

        ./start-webserver.sh

or (mainly for testing and development):

.. code-block:: bash

        python3 start_gunicorn_interactive.py


